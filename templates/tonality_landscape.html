{% extends 'base.html' %}
{% block head %}
<head>
    <meta charset=utf-8 />
    <meta name=viewport content=width=device-width, initial-scale=1.0 />
    <meta name=generator content=Codeply />
    <title>Tonality Landscape</title>
    <base target=_self>
    <link rel=stylesheet href=//cdnjs.cloudflare.com/ajax/libs/normalize/8.0.1/normalize.min.css />
    <link rel=stylesheet href=https://maxcdn.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.4.0/Chart.min.js"></script>

    <script type="text/javascript" src="https://cdn.jsdelivr.net/jquery/latest/jquery.min.js"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/momentjs/latest/moment.min.js"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.min.js"></script>
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.css"/>

    
    <!-- Add icon library -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <!-- <link rel="stylesheet" type="text/css" href="../static/css//bootstrap__.min.css"></link> -->

    
</head>
{% endblock %}

{% block body %}
<style>


.highcharts-figure,
  .highcharts-data-table table {
      min-width: 310px;
      max-width: 1000px;
      max-height: 2000;
      margin: auto;
  }

</style>

  <figure class="highcharts-figure">
  {% for message in get_flashed_messages() %}
  <div class="alert alert-warning alert-dismissible fade show" role="alert" style="color: red;">
    {{ message }}
    </div>
  {% endfor %}
      
  <form action="/tonality_landscape" method="POST" style="margin-top: 20px;">
  <div class="input-group">
    <div class="input-group-prepend" id="button-addon3" style="height: 28px;">
      <select name="file_choose" class="form-select-sm">
        <option selected>select File</option>
            {% for i in range(0, len_files) %}
                <option value="{{ files[i] }}">{{ files[i] }}</option>
            {% endfor %}
        </select>
      <input type="text" name="daterange" value="01/01/2022 - 01/12/2022"/>
      <input type="submit" href="{{ url_for('media_rating') }}" name="send" value="Запуск">
    </div>
  </div>
  </form>

    <script>
      $(function() {
        $('input[name="daterange"]').daterangepicker({
          opens: 'left'
        }, function(start, end, label) {
          console.log("A new date selection was made: " + start.format('YYYY-MM-DD') + ' to ' + end.format('YYYY-MM-DD'));
        });
      });
      </script>
<div class="container">
    <div class="row my-2">
        <div class="col-md-6 py-1">
            <div class="card">
                <div class="card-body">
                    <canvas id="chLine"></canvas>
                </div>
            </div>
        </div>
        <div class="col-md-6 py-1">
            <div class="card">
                <div class="card-body">
                    <canvas id="chBar"></canvas>
                </div>
            </div>
        </div>
    </div>
    <div class="row py-2">
        <div class="col-md-6 py-1">
            <div class="card">
                <div class="card-body">
                    <canvas id="chDonut1"></canvas>
                </div>
            </div>
        </div>
        <div class="col-md-6 py-1">
            <div class="card">
                <div class="card-body">
                    <canvas id="chDonut2"></canvas>
                </div>
            </div>
        </div>
        <div>

        <figure className="col-md-4 py-1">
          <div id="container"></div>
          <p className="highcharts-description">
            Сопоставительный график тонального ландшафта в инфополе.
            Показывает соотношение позитив-негатив и анализ "тональных" авторов.
          </p>
        </figure>
        </div>
    </div>
  </div>
</div>
  <script src="https://code.highcharts.com/highcharts.js"></script>
  <script src="https://code.highcharts.com/modules/sunburst.js"></script>
  <script src="https://code.highcharts.com/modules/exporting.js"></script>
  <script src="https://code.highcharts.com/modules/export-data.js"></script>
  <script src="https://code.highcharts.com/modules/accessibility.js"></script>

  <script>
    
  /* chart.js chart examples */


// chart colors
// https://www.rapidtables.com/web/color/green-color.html
var colors = ['#ff003b','#28a745','#333333','#ef0f42','#dc3545','#6c757d'];
var colors_red = ['#8B0000', '#B22222', '#DC143C', '#FF0000', '#CD5C5C', '#F08080', '#FA8072', '#FF6347', '#FF4500', '#DB7093', '#FFA07A'];
var colors_green = ['#006400', '#008000', '#2E8B57', '#3CB371', '#90EE90', '#32CD32', '#9ACD32', '#7FFF00', '#00FF00', '#9ACD32', '#00FF7F', '#8FBC8F'];

/* large line chart */
var chLine = document.getElementById("chLine");
var datagraph = JSON.parse('{{ datagraph|tojson }}');


var chartData = {
  labels: datagraph.pos_list_name,
  datasets: [{
    data: datagraph.pos_list_data,
    backgroundColor: 'transparent',
    borderColor: colors[0],
    borderWidth: 4,
    pointBackgroundColor: colors[0]
  }]
};
if (chLine) {
  new Chart(chLine, {
  type: 'line',
  data: chartData,
  options: {
    scales: {
      xAxes: [{
        ticks: {
          beginAtZero: false
        }
      }]
    },
    legend: {
      display: false
    },
    responsive: true
  }
  });
}


/* bar chart */
var chBar = document.getElementById("chBar");
if (chBar) {
  new Chart(chBar, {
  type: 'bar',
  data: {
    labels: datagraph.pos_list_name,
    datasets: [{
      data: datagraph.pos_list_data,
      backgroundColor: colors[0]
    },
    {
      data: datagraph.neg_list_data,
      backgroundColor: colors[1]
    }]
  },
  options: {
    legend: {
      display: false
    },
    scales: {
        ticks: {
        beginAtZero: true,
        min: 0},
      xAxes: [{
        display: true,
        ticks: {
          beginAtZero: true,
          max: 100,
          min: 0
        },
        barPercentage: 0.6,
        categoryPercentage: 0.4
      }]
    }
  }
  });
}

/* 3 donut charts */
var donutOptions = {
  cutoutPercentage: 85,
  legend: {position:'bottom', padding:5, labels: {pointStyle:'circle', usePointStyle:false}}
};

// donut 1
var chDonutData1 = {
    labels: datagraph.data_tonality_hub_pos_name,
    datasets: [
      {
        backgroundColor: colors_red.slice(0,11),
        borderWidth: 0,
        data: datagraph.data_tonality_hub_pos_data
      }
    ]
};

var chDonut1 = document.getElementById("chDonut1");
if (chDonut1) {
  new Chart(chDonut1, {
      type: 'pie',
      data: chDonutData1,
      options: donutOptions
  });
}

// donut 2
var chDonutData2 = {
    labels: datagraph.data_tonality_hub_neg_name,
    datasets: [
      {
        backgroundColor: colors_green.slice(0,12),
        borderWidth: 0,
        data: datagraph.data_tonality_hub_neg_data
      }
    ]
};
var chDonut2 = document.getElementById("chDonut2");
if (chDonut2) {
  new Chart(chDonut2, {
      type: 'pie',
      data: chDonutData2,
      options: donutOptions
  });
}

// BIGdonut 3
// var namegraph = datagraph.superDonatName.concat(' ', "Негатив: " + datagraph.percent_neg + "%").concat(' ', "Позитив: " + datagraph.percent_pos + "%")

var data = [{
  id: '0.0',
  parent: '',
  name: datagraph.superDonatName, 
}];


data.push({
id: '1.0',
parent: '0.0',
name: "Позитив: " + datagraph.percent_pos + "%" });

data.push({
id: '1.1',
parent: '0.0',
name: "Негатив: " + datagraph.percent_neg + "%"});

data.push({
id: '1.2',
parent: '0.0',
name: 'Neutral'});


// Neg
for (i = 0; i < datagraph.neg1.length; i++) {
    data.push({
    id: '2.' + i,
    parent: '1.0',
    name: datagraph.neg1[i],
    value: datagraph.hub_neg_val[i]});
}

for (i = 0; i < datagraph.neg2.length; i++) {
    for (j = 0; j < datagraph.neg2[i].length; j++)

    data.push({
    id: '3.' + i,
    parent: '2.' + i,
    name: datagraph.neg2[i][j],
    value: datagraph.neg3[i][j]})
}

// Pos
for (i = 0; i < datagraph.pos1.length; i++) {
    data.push({
    id: '4.' + i,
    parent: '1.1',
    name: datagraph.pos1[i],
    value: datagraph.hub_pos_val[i]});
}

for (i = 0; i < datagraph.pos2.length; i++) {
    for (j = 0; j < datagraph.pos2[i].length; j++)

    data.push({
    id: '5.' + i,
    parent: '4.' + i,
    name: datagraph.pos2[i][j],
    value: datagraph.pos3[i][j]})
}


Highcharts.chart('container', {

  chart: {
    height: '100%'
  },

  // Let the center circle be transparent
  colors: ['#eeeaea', '#28a745', '#8B0000'],
  // ['transparent'].concat(Highcharts.getOptions().colors),

  title: {
    text: 'Authors landscape'
  },

  // subtitle: {
  //   text: 'Source <a href="https://en.wikipedia.org/wiki/List_of_countries_by_population_(United_Nations)">Wikipedia</a>'
  // },

  series: [{
    type: 'sunburst',
    data: data,
    name: 'Root',
    allowDrillToNode: true,
    cursor: 'pointer',
    dataLabels: {
      format: '{point.name}',
      filter: {
        property: 'innerArcLength',
        operator: '>',
        value: 16
      },
      rotationMode: 'circular'
    },
    levels: [{
      level: 1,
      levelIsConstant: false,
      dataLabels: {
        filter: {
          property: 'outerArcLength',
          operator: '>',
          value: 64
        }
      }
    }, {
      level: 2,
      colorByPoint: true
    },
    {
      level: 3,
      colorVariation: {
        key: 'brightness',
        to: -0.5
      }
    }, {
      level: 4,
      colorVariation: {
        key: 'brightness',
        to: 0.5
      }
    }]

  }],

  tooltip: {
    headerFormat: '',
    pointFormat: 'Количество сообщений <b>{point.name}</b> : <b>{point.value}</b>'
  }
});



  </script>
  </figure>

{% endblock %}